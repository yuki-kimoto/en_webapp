<h2>会員登録フォームのバリデーション</h2>

会員登録フォームのバリデーションの処理を書いていきましょう。バリデーションとは、ユーザーから入力されたデータが正しいものであるかを検証する作業のことをいいます。

<h3>送信されたユーザー情報を取得する</h3>

送信されたユーザー情報は、パラメーターから取得します。ユーザー情報が入ったパラメーターを取得するには<a href="https://tutorial.perlzemi.com/blog/20110501130707.html">paramメソッド</a>を使用します。

<a href="/blog/20200107082558.html">会員登録フォーム</a>からPOSTされた情報を受け取ってみましょう。この処理では、POSTであって、仮登録の処理であるかを、事前に確認しています。

<pre>
<%
  # POSTリクエストの処理
  if ($self->method eq 'POST') {
    # 処理方法
    my $op = param('op');
    $op = '' unless defined $op;
    
    # 仮登録の処理
    if ($op eq 'register') {
      # ユーザー情報の取得
      # ユーザーID
      my $code = param('code');
      
      # パスワード
      my $password = param('password');
      
      # メールアドレス
      my $mail = param('mail');
    }
  }
%>
</pre>

<h3>ユーザーIDのバリデーション</h3>

ユーザーIDが正しいものであることを確認しましょう。ユーザーIDが正しいというのは、Mojoliciousスタートアップでは次のように定義します。

<ul>
  <li>ユーザーIDが、ASCIIコードの英数字とアンダーバーの1文字以上で構成されていること</li>
  <li>ユーザーIDの長さが、仮登録ユーザーテーブルと、ユーザーテーブルのユーザーIDの長さに収まること</li>
  <li>ユーザーIDが、ユーザーテーブルに存在するユーザーIDと重複しないこと</li>
</ul>

ユーザーIDは、一意でなければならないので、これをチェックするために、データベースにアクセスする必要があることに注意しましょう。

ユーザーIDのバリデーションを書いていきましょう。正しくない場合は、エラー情報に追加するようにしています。

O/Rマッパーは、<a href="https://tutorial.perlzemi.com/blog/20110401130559.html">DBIx::Custom</a>です。

<h4>ユーザーIDが、ASCIIコードの英数字とアンダーバーの1文字以上で構成されていること</h4>

ユーザーIDが、ASCIIコードの英数字とアンダーバーの1文字(a-zA-Z0-9_)以上で構成されていることをチェックするには、Perlの正規表現を使いましょう。

<a href="https://tutorial.perlzemi.com/blog/20100827127859.html">正規表現</a>は以下の二つのどちらかで表現できます。素直に文字クラスで書くか、PerlのASCIIコードで構成されたワード文字を表現する文字クラスを使います。

<pre>
# 文字クラスで素直に書く
^[a-zA-Z0-9_]+$

# PerlのASCIIコードで構成されたワード文字を表現する文字クラスを使う
^\p{PosixWord}+$
</pre>

(執筆中)
